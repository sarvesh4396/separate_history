class Create<%= history_class_name %> < ActiveRecord::Migration[<%= ActiveRecord::Migration.current_version %>]
  def change
    create_table :<%= history_table_name %> do |t|
<% original_columns.each do |column| -%>
      <%-
  options = {
    limit: column.limit,
    precision: column.precision,
    scale: column.scale,
    null: true, # Force null to be true for all columns
    default: column.default
  }.compact

  # Always include null: true, even if it was nil before
  options[:null] = true

  options_string = options.map { |k, v| "#{k}: #{v.inspect}" }.join(', ')
-%>
      t.<%= column.type %> :<%= column.name %><%= ", #{options_string}" if options_string.present? %>
<% end -%>
      t.integer :original_id, null: false
      t.string :event, null: false
      t.datetime :history_created_at, null: false
      t.datetime :history_updated_at, null: false

      t.index :original_id
    end
  end
end
